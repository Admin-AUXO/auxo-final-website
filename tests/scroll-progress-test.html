<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scroll Progress Test</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui;
      padding: 20px;
    }

    .metrics {
      position: fixed;
      top: 50px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 20px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      z-index: 1000;
    }

    .metrics div {
      margin: 5px 0;
    }

    .metrics .value {
      color: #4ade80;
      font-weight: bold;
    }

    .metrics .issue {
      color: #ef4444;
      font-weight: bold;
    }

    .content {
      height: 5000px;
      background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
    }

    .marker {
      position: absolute;
      left: 0;
      right: 0;
      padding: 10px 20px;
      background: rgba(59, 130, 246, 0.3);
      border-top: 2px solid #3b82f6;
    }
  </style>
</head>
<body>
  <h1>Scroll Progress Calculation Test</h1>
  <p>Scroll down to test different calculation methods</p>

  <div class="metrics" id="metrics">
    <div>Scroll Position: <span class="value" id="scrollPos">0</span>px</div>
    <div>Scroll Height: <span class="value" id="scrollHeight">0</span>px</div>
    <div>Viewport Height: <span class="value" id="viewportHeight">0</span>px</div>
    <div>Scrollable Height: <span class="value" id="scrollableHeight">0</span>px</div>
    <div style="margin-top: 15px; border-top: 1px solid #666; padding-top: 10px;">
      <div>✅ Correct (px / scrollable): <span class="value" id="correctPercent">0</span>%</div>
      <div>❌ Bug (viewports * 100): <span class="issue" id="bugPercent">0</span>%</div>
      <div>Normalized scroll: <span class="value" id="normalized">0</span> viewports</div>
    </div>
  </div>

  <div class="content">
    <div class="marker" style="top: 0;">Top of page (0%)</div>
    <div class="marker" style="top: 25%;">25% of content</div>
    <div class="marker" style="top: 50%;">50% of content</div>
    <div class="marker" style="top: 75%;">75% of content</div>
    <div class="marker" style="top: 99%;">End of page (100%)</div>
  </div>

  <script>
    function updateMetrics() {
      const scrollPos = window.scrollY;
      const scrollHeight = document.documentElement.scrollHeight;
      const viewportHeight = window.innerHeight;
      const scrollableHeight = scrollHeight - viewportHeight;

      // Correct calculation (what should be used)
      const correctPercent = scrollableHeight > 0
        ? (scrollPos / scrollableHeight) * 100
        : 0;

      // Bug calculation (what's currently in the code)
      const normalizedScroll = scrollPos / viewportHeight; // This is what Lenis data.scroll represents
      const bugPercent = normalizedScroll * 100; // This is the buggy calculation

      document.getElementById('scrollPos').textContent = scrollPos.toFixed(0);
      document.getElementById('scrollHeight').textContent = scrollHeight.toFixed(0);
      document.getElementById('viewportHeight').textContent = viewportHeight.toFixed(0);
      document.getElementById('scrollableHeight').textContent = scrollableHeight.toFixed(0);
      document.getElementById('correctPercent').textContent = correctPercent.toFixed(1);
      document.getElementById('bugPercent').textContent = bugPercent.toFixed(1);
      document.getElementById('normalized').textContent = normalizedScroll.toFixed(2);
    }

    window.addEventListener('scroll', updateMetrics, { passive: true });
    window.addEventListener('resize', updateMetrics, { passive: true });
    updateMetrics();
  </script>
</body>
</html>
