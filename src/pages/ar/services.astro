---
import BaseLayout from "@/layouts/BaseLayout.astro";
import StructuredData from "@/components/common/StructuredData.astro";
import { getSiteConfigData } from "@/lib/sanity/siteConfig";
import HeroSection from "@/components/sections/services/HeroSection.astro";
import ServicesStageSection from "@/components/sections/services/ServicesStageSection.astro";
import ImpactSection from "@/components/sections/services/ImpactSection.astro";
import ModelsSection from "@/components/sections/services/ModelsSection.astro";
import CtaSection from "@/components/sections/common/CtaSection.astro";
import { getServicesContent } from "@/lib/sanity/data";
import { getLanguageFromUrl } from "@/i18n";

const lang = getLanguageFromUrl(Astro.url);

const [servicesContent, siteData] = await Promise.all([
  getServicesContent(lang),
  getSiteConfigData(),
]);

const breadcrumbSchema = {
  itemListElement: [
    {
      '@type': 'ListItem',
      position: 1,
      name: 'Home',
      item: siteData.url,
    },
    {
      '@type': 'ListItem',
      position: 2,
      name: 'Services',
      item: `${siteData.url}/ar/services`,
    },
  ],
};
---

<BaseLayout
  title="الخدمات | AUXO Data Labs"
  description="التحليلات كخدمة، مصممة للتأثير. اكتشف عروضنا الثمانية الموافقة مع منحنى نضج التحليلات."
>
  <StructuredData type="BreadcrumbList" data={breadcrumbSchema} />
  <HeroSection content={servicesContent.hero} />
  <ServicesStageSection content={servicesContent.serviceOfferings} />
  <ImpactSection content={servicesContent.impact} />
  <ModelsSection content={servicesContent.engagementModels} />
  <CtaSection
    id="services-cta"
    title={servicesContent.cta.title}
    titleHighlight={["Analytics Roadmap", "Reality"]}
    description={servicesContent.cta.description}
    descriptionHighlight={servicesContent.cta.descriptionHighlight}
    ctaText={servicesContent.cta.ctaText}
    ctaHref={servicesContent.cta.ctaHref}
    variant="standard"
    background="default"
    maxWidth="4xl"
    class="services-cta-section"
  />

  <script>
    import { trackServiceCategoryView } from '@/scripts/analytics/ga4';

    if (typeof window !== 'undefined') {
      document.addEventListener('astro:page-load', () => {
        trackServiceCategoryView('data-analytics-services');
      });
    }
  </script>
</BaseLayout>
