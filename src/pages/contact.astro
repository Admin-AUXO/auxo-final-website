---
import BaseLayout from "../layouts/BaseLayout.astro";
import { siteData } from "../data/config/site";
import { Icon } from "astro-icon/components";
import BackgroundDecorations from "../components/ui/BackgroundDecorations.astro";
import { createUrl } from "../utils/url";
import Button from "../components/ui/Button.astro";
import ContactForm from "../components/forms/ContactForm.astro";
import "../styles/sections/contact-sections.css";
---

<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">

<BaseLayout
  title="Contact Us | AUXO Data Labs"
  description="Get in touch with AUXO Data Labs. We're here to help transform your data analytics capabilities. Contact us for inquiries, consultations, or partnerships."
  showParticles={false}
>
  <section
    id="contact-main"
    class="relative w-full min-h-screen flex items-center justify-center overflow-hidden py-12 sm:py-20 lg:py-24 px-4 sm:px-6"
  >
    <BackgroundDecorations gradients={["hero"]} patterns={["grid"]} />

    <div class="grid-container relative z-10 w-full">
      <div class="col-span-full max-w-7xl mx-auto w-full">
        <div class="text-center mb-10 sm:mb-12 lg:mb-16">
          <h1 class="text-h1 font-extrabold mb-4 sm:mb-5 leading-tight tracking-tight text-theme-primary font-display" data-aos="fade-down">
            Let's <span class="text-accent-green font-black text-[1.05em]">Connect</span>
          </h1>
          <p class="text-base sm:text-body-lg lg:text-body-xl text-theme-secondary leading-relaxed max-w-2xl mx-auto font-body" data-aos="fade-up" data-aos-delay="100">
            Ready to transform your data analytics? Start with a conversation.
          </p>
        </div>

        <div class="mb-12 sm:mb-16 lg:mb-20" data-aos="zoom-in" data-aos-delay="150">
          <div class="calendly-inline-widget-container max-w-5xl mx-auto bg-theme-card/50 backdrop-blur-sm rounded-2xl border border-accent-green/20 overflow-hidden shadow-2xl">
            <div
              id="calendly-widget"
              class="calendly-inline-widget"
              data-url="https://calendly.com/admin-auxodata/30min"
            ></div>
          </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 xl:gap-16" id="contact-form">
          <div class="space-y-6 lg:space-y-8" data-aos="fade-right" data-aos-duration="400" data-aos-delay="200">
            <div class="text-center lg:text-left">
              <h2 class="text-h3 font-extrabold mb-3 text-theme-primary font-display">
                Reach Out
              </h2>
              <p class="text-theme-secondary font-body leading-relaxed max-w-md mx-auto lg:mx-0">
                We typically respond within 24 hours. Share your challenge, and we'll provide insights on how we can help.
              </p>
            </div>

            <div class="space-y-4 max-w-md mx-auto lg:mx-0 lg:max-w-none">
              <a
                href={`mailto:${siteData.email}`}
                class="flex items-center gap-4 p-4 sm:p-5 rounded-xl bg-theme-card border border-accent-green/20 hover:border-accent-green/40 hover:shadow-lg hover:shadow-accent-green/10 hover:-translate-y-0.5 transition-all duration-300 group"
              >
                <div class="w-12 h-12 bg-accent-green/15 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-accent-green/25 group-hover:scale-110 transition-all">
                  <Icon name="mdi:email-outline" class="w-6 h-6 text-accent-green" />
                </div>
                <div class="flex-1 min-w-0">
                  <div class="text-xs font-semibold text-theme-secondary mb-1 font-body uppercase tracking-wide">Email</div>
                  <div class="text-sm sm:text-base font-bold text-theme-primary font-body truncate group-hover:text-accent-green transition-colors">
                    {siteData.email}
                  </div>
                </div>
                <Icon name="mdi:arrow-right" class="w-5 h-5 text-accent-green opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all flex-shrink-0" />
              </a>

              <div class="flex items-center gap-4 p-4 sm:p-5 rounded-xl bg-theme-card border border-accent-green/20">
                <div class="w-12 h-12 bg-accent-green/15 rounded-lg flex items-center justify-center flex-shrink-0">
                  <Icon name="mdi:map-marker" class="w-6 h-6 text-accent-green" />
                </div>
                <div class="flex-1">
                  <div class="text-xs font-semibold text-theme-secondary mb-1 font-body uppercase tracking-wide">Location</div>
                  <div class="text-sm sm:text-base font-bold text-theme-primary font-body">
                    {siteData.address.city}, {siteData.address.country}
                  </div>
                </div>
              </div>

              <div class="flex items-center gap-4 p-4 sm:p-5 rounded-xl bg-accent-green/10 border border-accent-green/30">
                <div class="w-12 h-12 bg-accent-green/20 rounded-lg flex items-center justify-center flex-shrink-0">
                  <Icon name="mdi:clock-check-outline" class="w-6 h-6 text-accent-green" />
                </div>
                <div class="flex-1">
                  <div class="text-xs font-semibold text-theme-secondary mb-1 font-body uppercase tracking-wide">Response Time</div>
                  <div class="text-base sm:text-lg font-extrabold text-accent-green font-display">
                    {siteData.stats.responseTime}
                  </div>
                </div>
              </div>
            </div>

          </div>

          <div class="max-w-md mx-auto lg:mx-0 lg:max-w-none w-full" data-aos="fade-left" data-aos-delay="200">
            <ContactForm />
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script is:inline>
  (function() {
    const CALENDLY_BASE_URL = 'https://calendly.com/admin-auxodata/30min';
    const THEME_CHANGE_EVENT = 'themechange';

    const THEME_COLORS = {
      dark: {
        primary: 'a3e635',
        background: '0f0f0f',
        text: 'ffffff'
      },
      light: {
        primary: '7cb342',
        background: 'ffffff',
        text: '111827'
      }
    };

    function getCurrentTheme() {
      return document.documentElement.classList.contains('light') ? 'light' : 'dark';
    }

    function getCalendlyUrl() {
      const theme = getCurrentTheme();
      const colors = THEME_COLORS[theme];
      return `${CALENDLY_BASE_URL}?hide_gdpr_banner=1&primary_color=${colors.primary}&background_color=${colors.background}&text_color=${colors.text}`;
    }

    function initCalendlyWidget() {
      const widget = document.getElementById('calendly-widget');
      if (!widget || !window.Calendly) return;

      widget.innerHTML = '';
      widget.setAttribute('data-url', getCalendlyUrl());
      window.Calendly.initInlineWidget({
        url: getCalendlyUrl(),
        parentElement: widget
      });
    }

    function loadCalendlyScript() {
      if (window.Calendly) {
        initCalendlyWidget();
        return;
      }

      const script = document.createElement('script');
      script.src = 'https://assets.calendly.com/assets/external/widget.js';
      script.async = true;
      script.onload = initCalendlyWidget;
      document.body.appendChild(script);
    }

    document.addEventListener(THEME_CHANGE_EVENT, function() {
      initCalendlyWidget();
    });

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadCalendlyScript);
    } else {
      loadCalendlyScript();
    }
  })();
</script>

<script>
  import { setupContactPage } from "../scripts/pages/contactPage";
  import { setupSectionInit } from "../scripts/sections/utils/initUtils";
  import { initEmailJS, handleContactFormSubmit, addRealTimeValidation } from "../scripts/forms/emailHandler";
  import { initNotifications } from "../scripts/utils/notifications";

  setupSectionInit(setupContactPage);
  initEmailJS();
  initNotifications();

  const form = document.getElementById('contact-form-element') as HTMLFormElement;
  if (form) {
    form.addEventListener('submit', handleContactFormSubmit);
    addRealTimeValidation(form);
  }
</script>

<style>
  .calendly-inline-widget-container {
    position: relative;
    min-height: 650px;
    height: 700px;
    box-shadow:
      0 20px 50px rgba(0, 0, 0, 0.3),
      0 0 0 1px rgba(163, 230, 53, 0.1),
      inset 0 1px 0 rgba(163, 230, 53, 0.05);
  }

  @media (max-width: 768px) {
    .calendly-inline-widget-container {
      min-height: 600px;
      height: 650px;
    }
  }

  .calendly-inline-widget {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 100%;
  }

  :global(.calendly-inline-widget iframe) {
    border-radius: 1rem;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 640px) {
    .calendly-inline-widget-container {
      border-radius: 1rem;
      margin-left: 0;
      margin-right: 0;
      width: 100%;
      overflow: hidden;
    }

    :global(.calendly-inline-widget iframe) {
      overflow: hidden !important;
    }
  }
</style>
