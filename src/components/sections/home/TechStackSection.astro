---
import { Icon } from "astro-icon/components";
import SectionContainer from "@/components/layouts/SectionContainer.astro";
import SectionHeader from "@/components/ui/SectionHeader.astro";
import type { HomepageContent } from "@/data/content/homepage";

interface Props {
  content: HomepageContent["techStack"];
}

const { content } = Astro.props;
const items = Array.isArray(content?.items) ? content.items : [];
const duplicatedItems = items.length > 0 ? [...items, ...items] : [];
---

<SectionContainer
  id="tech-stack"
  padding="lg"
  background="card"
  class="relative tech-stack-section section-divider overflow-hidden"
>
  <div class="section-gradient-center absolute inset-0 pointer-events-none z-0"></div>
  
  <div class="grid-container relative z-10">
    <div class="col-span-full max-w-7xl mx-auto w-full">
      <div data-reveal="fade-down" data-reveal-duration="250" data-reveal-easing="ease-out">
        <SectionHeader
          title={content?.title || ''}
          subtitle={content?.subtitle || ''}
          highlight="Technologies"
        />
      </div>

      {items.length > 0 ? (
        <div class="tech-stack-marquee-wrapper relative py-4 sm:py-6">
          <div class="tech-stack-marquee-track flex gap-8 sm:gap-12 lg:gap-16" id="tech-stack-track">
            {duplicatedItems.map((item, index) => (
              <div
                class="tech-stack-item flex-shrink-0 flex items-center justify-center gap-3 px-4 sm:px-6 py-2 rounded-lg transition-all duration-300"
              >
                <Icon 
                  name={item.icon} 
                  class="tech-stack-icon w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12" 
                />
                <span class="tech-stack-name text-body-lg sm:text-[1.1875rem] lg:text-xl font-semibold whitespace-nowrap">
                  {item.name}
                </span>
              </div>
            ))}
          </div>
        </div>
      ) : (
        <div class="py-4 sm:py-6 text-center text-theme-secondary">
          <p>Tech stack items coming soon...</p>
        </div>
      )}
    </div>
  </div>
</SectionContainer>

<style>
  .tech-stack-section {
    overflow: hidden;
  }

  .tech-stack-marquee-wrapper {
    overflow: hidden;
    mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
  }

  .tech-stack-marquee-track {
    display: flex;
    width: max-content;
    animation: tech-stack-scroll 60s linear infinite;
    animation-play-state: running;
    will-change: transform;
  }

  .tech-stack-item {
    transition: transform 0.3s ease, background-color 0.3s ease;
  }

  .tech-stack-item:hover {
    transform: translateY(-4px);
    background-color: var(--accent-green-opacity-05);
  }

  .tech-stack-icon {
    color: var(--accent-green);
    transition: filter 0.3s ease;
  }

  .tech-stack-item:hover .tech-stack-icon {
    filter: brightness(1.2);
  }

  .tech-stack-name {
    color: var(--text-primary);
    transition: color 0.3s ease;
  }

  .tech-stack-item:hover .tech-stack-name {
    color: var(--accent-green);
  }

  @keyframes tech-stack-scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .tech-stack-marquee-track {
      animation: none;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    
    .tech-stack-marquee-track::-webkit-scrollbar {
      display: none;
    }
  }

  .tech-stack-marquee-wrapper:hover .tech-stack-marquee-track {
    animation-play-state: paused;
  }
</style>

<script>
  import { initTechStackSection } from '@/scripts/sections/home/techStackSection';
  import { setupSectionInit } from '@/scripts/sections/utils/initUtils';
  setupSectionInit(initTechStackSection);
</script>

