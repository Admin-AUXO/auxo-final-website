---
import { Icon } from "astro-icon/components";
import SectionContainer from "../../layouts/SectionContainer.astro";
import SectionHeader from "../../ui/SectionHeader.astro";
import {
  homepageContent,
  type HomepageContent,
} from "../../../data/content/homepage";

const content: HomepageContent["techStack"] = homepageContent.techStack;
// Duplicate items for seamless loop
const duplicatedItems = [...content.items, ...content.items];
---

<SectionContainer
  id="tech-stack"
  padding="lg"
  background="card"
  class="relative tech-stack-section section-divider overflow-hidden"
>
  <div class="section-gradient-center absolute inset-0 pointer-events-none z-0"></div>
  
  <div class="grid-container relative z-10">
    <div class="col-span-full max-w-7xl mx-auto w-full">
      <div class="mb-8 sm:mb-12 lg:mb-16">
        <SectionHeader
          title={content.title}
          subtitle={content.subtitle}
          highlight="Technologies"
        />
      </div>

      <div 
        class="tech-stack-marquee-wrapper overflow-hidden relative py-4 sm:py-6"
        data-aos="fade-up"
        data-aos-duration="600"
        data-aos-easing="ease-out-cubic"
        data-aos-delay="50"
      >
        <div class="tech-stack-marquee-track flex gap-8 sm:gap-12 lg:gap-16" id="tech-stack-track">
          {duplicatedItems.map((item, index) => (
            <div
              class="tech-stack-item flex-shrink-0 flex items-center justify-center gap-3 px-4 sm:px-6 py-2 rounded-lg transition-all duration-300"
              data-index={index}
              data-aos="fade-left"
              data-aos-duration="800"
              data-aos-easing="ease-out-cubic"
              data-aos-delay={50 + (index % content.items.length) * 20}
            >
              <div class="tech-stack-icon-wrapper">
                <Icon 
                  name={item.icon} 
                  class="tech-stack-icon w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12" 
                />
              </div>
              <span class="tech-stack-name text-base sm:text-lg lg:text-xl font-semibold whitespace-nowrap">
                {item.name}
              </span>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</SectionContainer>

<style>
  .tech-stack-section {
    position: relative;
  }

  .tech-stack-marquee-wrapper {
    mask-image: linear-gradient(
      to right,
      transparent 0%,
      black 5%,
      black 95%,
      transparent 100%
    );
    -webkit-mask-image: linear-gradient(
      to right,
      transparent 0%,
      black 5%,
      black 95%,
      transparent 100%
    );
  }

  .tech-stack-marquee-track {
    animation: tech-stack-scroll 20s linear infinite;
    will-change: transform;
    transition: transform 0.1s ease-out;
  }

  .tech-stack-item {
    transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s ease;
  }

  .tech-stack-item:hover {
    transform: translateY(-4px);
    background-color: var(--accent-green-opacity-05);
  }

  .tech-stack-icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }


  .tech-stack-icon {
    color: var(--accent-green);
    transition: color 0.3s ease, filter 0.3s ease;
  }

  .tech-stack-item:hover .tech-stack-icon {
    color: var(--accent-green);
    filter: brightness(1.2);
  }

  .tech-stack-name {
    color: var(--text-primary);
    transition: color 0.3s ease;
  }

  .tech-stack-item:hover .tech-stack-name {
    color: var(--accent-green);
  }

  @keyframes tech-stack-scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  /* Smooth acceleration and deceleration */
  .tech-stack-marquee-track.aos-animate {
    animation: tech-stack-scroll 20s linear infinite;
  }

  @media (prefers-reduced-motion: reduce) {
    .tech-stack-marquee-track {
      animation: none;
    }
    
    .tech-stack-marquee-track {
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    
    .tech-stack-marquee-track::-webkit-scrollbar {
      display: none;
    }
  }

  /* Pause animation on hover */
  .tech-stack-marquee-wrapper:hover .tech-stack-marquee-track {
    animation-play-state: paused;
  }

  /* Theme-aware adjustments */
  @media (prefers-color-scheme: dark) {
    .tech-stack-icon {
      color: var(--accent-green);
    }
  }

  @media (prefers-color-scheme: light) {
    .tech-stack-icon {
      color: var(--accent-green);
    }
  }
</style>

<script>
  import "../../../scripts/sections/home/techStackSection";
</script>
