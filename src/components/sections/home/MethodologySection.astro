---
import { Icon } from "astro-icon/components";
import MethodologyStep from '@/components/ui/MethodologyStep.astro';
import SectionContainer from '@/components/layouts/SectionContainer.astro';
import SectionHeader from '@/components/ui/SectionHeader.astro';
import BackgroundDecorations from '@/components/ui/BackgroundDecorations.astro';
import type { HomepageContent } from '@/data/content/homepage';
import { createUrl } from '@/utils/url';

interface Props {
  content: HomepageContent["methodology"];
}

const { content } = Astro.props;
---

<SectionContainer
  id="methodology"
  padding="lg"
  background="card"
  class="relative methodology-section section-divider"
>
  <BackgroundDecorations gradients={["center"]} patterns={["grid"]} />
  
  <div class="grid-container relative z-10">
    <div class="col-span-full max-w-7xl mx-auto w-full">
      <div data-reveal="fade-down" data-reveal-duration="200" data-reveal-delay="0" data-reveal-easing="ease-out">
        <SectionHeader
          title={`${content.title} ${content.titleHighlight}`}
          subtitle={content.subtitle.replace(/\n\n/g, " ").replace(":", "")}
          highlight={content.titleHighlight}
        />
      </div>

      <div class="hidden lg:block methodology-flow relative overflow-hidden">
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-6 xl:gap-8 overflow-hidden px-2 max-w-[1400px] mx-auto items-stretch"
        >
          {content.steps.map((step, index) => (
            <MethodologyStep
              number={String(step.number)}
              title={step.title}
              description={step.description}
              descriptionHighlight={step.descriptionHighlight}
              output={step.output}
              index={index}
              variant="flow"
              isLast={index === content.steps.length - 1}
            />
          ))}
        </div>
      </div>

      <div class="lg:hidden methodology-accordion">
        <div class="accordion-container">
          {content.steps.map((step, index) => (
            <MethodologyStep
              number={String(step.number)}
              title={step.title}
              description={step.description}
              descriptionHighlight={step.descriptionHighlight}
              output={step.output}
              index={index}
              variant="accordion"
              isLast={index === content.steps.length - 1}
            />
          ))}
        </div>
      </div>
      {content.navigationButton && (
        <div class="text-center mt-8 sm:mt-10" data-reveal="fade-up" data-reveal-duration="200" data-reveal-delay="100" data-reveal-easing="ease-out">
          <a
            href={createUrl(content.navigationButton.href)}
            class="inline-flex items-center gap-2 text-accent-green lg:hover:text-accent-green/80 font-semibold text-base sm:text-body-lg transition-colors duration-300 group flex-nowrap whitespace-nowrap font-body"
          >
            <span class="whitespace-nowrap">
              {content.navigationButton.text}
            </span>
            <Icon
              name="mdi:arrow-right"
              class="w-5 h-5 flex-shrink-0 lg:group-hover:translate-x-2 transition-transform duration-300"
            />
          </a>
        </div>
      )}
    </div>
  </div>
</SectionContainer>


