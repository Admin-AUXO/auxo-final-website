---
import { Icon } from "astro-icon/components";
import MethodologyStep from "../../ui/MethodologyStep.astro";
import SectionContainer from "../../layouts/SectionContainer.astro";
import type { HomepageContent } from "../../../data/content/homepage";
import { createUrl } from "../../../utils/url";

interface Props {
  content: HomepageContent["methodology"];
}

const { content } = Astro.props;
---

<SectionContainer
  id="methodology"
  padding="lg"
  background="card"
  class="relative min-h-auto md:min-h-[75vh] overflow-hidden methodology-section section-divider"
>
  <div class="section-pattern-grid absolute inset-0 pointer-events-none z-0"></div>
  <div class="section-gradient-center absolute inset-0 pointer-events-none z-0"></div>
  
  <div class="grid-container relative z-10">
    <div class="col-span-full max-w-7xl mx-auto w-full">
      <div class="text-center mb-8 sm:mb-12 lg:mb-16" data-aos="fade-down" data-aos-duration="700" data-aos-easing="ease-out-cubic">
        <h2
          class="text-h2 font-extrabold mb-5 sm:mb-6 lg:mb-8 text-theme-primary transition-colors leading-tight tracking-tight font-display"
        >
          {content.title} <span class="text-accent-green font-black text-[1.1em]">{content.titleHighlight}</span>
        </h2>
        <div class="max-w-4xl mx-auto mb-5 sm:mb-6 lg:mb-8" data-aos="fade-up" data-aos-delay="150" data-aos-duration="600" data-aos-easing="ease-out-cubic">
          <p
            class="text-body-lg sm:text-body-xl font-bold text-theme-primary leading-relaxed transition-colors font-display"
          >
            {content.subtitle.split("\n\n")[0]}
          </p>
        </div>
        <div class="max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="250" data-aos-duration="600" data-aos-easing="ease-out-cubic">
          <p
            class="text-base sm:text-body-lg text-theme-secondary leading-relaxed transition-colors font-body"
          >
            {content.subtitle.split("\n\n")[1]?.replace(":", "") || ""}
          </p>
        </div>
      </div>

      <div class="hidden lg:block methodology-flow relative overflow-x-visible">
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-6 xl:gap-8 overflow-x-visible px-2 max-w-[1400px] mx-auto"
        >
          {content.steps.map((step, index) => (
            <MethodologyStep
              number={String(step.number)}
              title={step.title}
              description={step.description}
              descriptionHighlight={step.descriptionHighlight}
              output={step.output}
              index={index}
              variant="flow"
              isLast={index === content.steps.length - 1}
            />
          ))}
        </div>
      </div>

      <div class="lg:hidden methodology-accordion">
        <div class="accordion-container">
          {content.steps.map((step, index) => (
            <MethodologyStep
              number={String(step.number)}
              title={step.title}
              description={step.description}
              descriptionHighlight={step.descriptionHighlight}
              output={step.output}
              index={index}
              variant="accordion"
              isLast={index === content.steps.length - 1}
            />
          ))}
        </div>
      </div>
      {content.navigationButton && (
        <div class="text-center mt-8 sm:mt-10" data-aos="fade-up" data-aos-delay="400" data-aos-duration="600" data-aos-easing="ease-out-cubic">
          <a
            href={createUrl(content.navigationButton.href)}
            class="inline-flex items-center gap-2 text-accent-green hover:text-accent-green/80 font-semibold text-base sm:text-body-lg transition-all duration-300 group flex-nowrap whitespace-nowrap font-body"
          >
            <span class="whitespace-nowrap">
              {content.navigationButton.text}
            </span>
            <Icon
              name="mdi:arrow-right"
              class="w-5 h-5 flex-shrink-0 group-hover:translate-x-2 transition-transform duration-300"
            />
          </a>
        </div>
      )}
    </div>
  </div>
</SectionContainer>

