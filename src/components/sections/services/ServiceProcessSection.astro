---
import { Icon } from "astro-icon/components";
import SectionContainer from "@/components/layouts/SectionContainer.astro";
import SectionHeader from "@/components/ui/SectionHeader.astro";
import HighlightText from "@/components/ui/HighlightText.astro";
import BackgroundDecorations from "@/components/ui/BackgroundDecorations.astro";
import Carousel from "@/components/ui/Carousel.astro";
import type { ServiceDetail } from "@/data/content/services";

interface Props {
  service: ServiceDetail;
}

type ProcessStep = {
  step: number;
  title: string;
  description: string;
  deliverables: string[];
};

const { service } = Astro.props;
---

<SectionContainer
  id="service-process"
  padding="lg"
  background="elevated"
  class="relative service-process-section section-divider overflow-hidden"
>
  <BackgroundDecorations gradients={["dual"]} patterns={["grid"]} />

  <div class="grid-container relative z-10">
    <div class="col-span-full max-w-[1400px] mx-auto w-full">
      <div data-reveal="fade-down" data-reveal-duration="200" data-reveal-easing="ease-out">
        <SectionHeader
          title={service.process.title}
          subtitle={service.process.description}
          subtitleHighlight={service.process.descriptionHighlight}
        />
      </div>

      <div class="hidden lg:grid lg:grid-cols-2 gap-8 xl:gap-10 relative items-stretch">
        {service.process.steps.map((step: ProcessStep, index: number) => {
          return (
            <div
              class="process-card-wrapper h-full"
              data-reveal="fade-up"
              data-reveal-delay={index * 40}
              data-reveal-duration="200"
              data-reveal-easing="ease-out"
            >
              <div class="group relative h-full bg-theme-card border border-accent-green/20 rounded-3xl p-8 lg:hover:border-accent-green/40 transition-colors duration-300 flex flex-col overflow-hidden">
                <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-accent-green/0 via-accent-green/40 to-accent-green/0 rounded-t-3xl"></div>

                <div class="flex items-start gap-6 mb-6">
                  <div class="relative flex-shrink-0">
                    <div class="w-16 h-16 bg-accent-green rounded-xl flex items-center justify-center">
                      <span class="text-2xl font-extrabold text-white font-display">{step.step}</span>
                    </div>
                  </div>

                  <div class="flex-1 pt-2">
                    <h3 class="text-h4 font-extrabold text-theme-primary font-display leading-tight">
                      {step.title}
                    </h3>
                  </div>
                </div>

                <p class="text-body-lg text-theme-secondary leading-relaxed mb-6 font-body flex-grow">
                  {step.description}
                </p>

                <div class="space-y-3 mt-auto">
                  <div class="flex items-center gap-3 mb-3">
                    <h4 class="text-xs font-extrabold text-accent-green font-body uppercase tracking-widest flex items-center gap-2">
                      <Icon name="mdi:check-circle-outline" class="w-3.5 h-3.5" />
                      Deliverables
                    </h4>
                    <div class="h-px flex-1 bg-border-color-light"></div>
                  </div>

                  <div class="grid grid-cols-1 gap-2">
                    {step.deliverables.map((deliverable: string) => (
                      <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 mt-0.5">
                          <Icon name="mdi:check-bold" class="w-4 h-4 text-accent-green" />
                        </div>
                        <span class="text-body-base text-theme-secondary font-body leading-relaxed">
                          {deliverable}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>

                <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-accent-green/8 via-accent-green/3 to-transparent rounded-tr-3xl opacity-60 lg:group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-accent-green/5 to-transparent rounded-bl-3xl opacity-40 lg:group-hover:opacity-80 transition-opacity duration-500 pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-accent-green/30 to-transparent rounded-b-3xl opacity-0 lg:group-hover:opacity-100 transition-opacity duration-500"></div>
              </div>
            </div>
          );
        })}
      </div>

      <div class="lg:hidden" data-service={service.slug}>
        <Carousel
          containerId="service-process-carousel-container"
          trackId="service-process-carousel-track"
          items={service.process.steps}
          wrapperClass="service-process-carousel-wrapper"
          breakpoint={1024}
          activateOnDesktop={false}
        >
          {service.process.steps.map((step: ProcessStep, index: number) => (
            <div class="carousel-slide embla__slide flex-shrink-0 flex justify-center h-full" data-index={index}>
              <div class="h-full bg-theme-card border border-accent-green/10 rounded-2xl relative overflow-hidden transition-colors duration-500 lg:hover:border-accent-green/40 flex flex-col">
                <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-accent-green/0 via-accent-green/30 to-accent-green/0 lg:hover:via-accent-green/60 transition-all duration-500" />

                <div class="relative z-10 flex flex-col h-full p-5 sm:p-6">
                  <div class="flex items-center justify-between mb-4 sm:mb-5">
                    <h3 class="font-bold text-theme-primary leading-tight font-display">
                      {step.title}
                    </h3>
                    <div class="inline-flex w-8 h-8 sm:w-9 sm:h-9 bg-gradient-to-br from-accent-green/20 to-accent-green/10 rounded-md items-center justify-center border border-accent-green/30 flex-shrink-0 ml-3">
                      <span class="text-sm sm:text-base font-extrabold text-accent-green font-display leading-none">{step.step}</span>
                    </div>
                  </div>

                  <p class="text-theme-secondary leading-relaxed font-body flex-grow mb-5 sm:mb-6">
                    {step.description}
                  </p>

                  <div class="space-y-2 mt-auto pt-4 sm:pt-5 border-t border-accent-green/10">
                    <h4 class="text-xs font-bold text-accent-green font-body uppercase tracking-wide leading-none mb-2">Deliverables</h4>
                    <ul class="space-y-2">
                      {step.deliverables.map((deliverable: string) => (
                        <li class="flex items-start gap-2 text-theme-secondary font-body leading-relaxed">
                          <span class="text-accent-green flex-shrink-0 leading-none mt-0.5">â€¢</span>
                          <span>{deliverable}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>

                <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-accent-green/30" />
              </div>
            </div>
          ))}
        </Carousel>
      </div>
    </div>
  </div>
</SectionContainer>

