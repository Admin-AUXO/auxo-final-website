---
import { Icon } from "astro-icon/components";
import SectionContainer from "../../layouts/SectionContainer.astro";
import HighlightText from "../../ui/HighlightText.astro";
import BackgroundDecorations from "../../ui/BackgroundDecorations.astro";
import Carousel from "../../ui/Carousel.astro";
import { ServiceDetail } from "../../../data/content/services";

interface Props {
  service: ServiceDetail;
}

const { service } = Astro.props;
---

<SectionContainer
  id="service-process"
  padding="lg"
  background="elevated"
  class="relative service-process-section section-divider overflow-x-hidden"
>
  <BackgroundDecorations gradients={["dual"]} patterns={["grid"]} />

  <div class="grid-container relative z-10">
    <div class="col-span-full max-w-6xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12 lg:mb-16">
        <h2 class="text-h2 font-extrabold mb-4 lg:mb-6 leading-tight tracking-tight font-display text-theme-primary">
          {service.process.title}
        </h2>
        <p class="text-body-lg sm:text-body-xl text-theme-secondary leading-relaxed max-w-3xl mx-auto font-body">
          <HighlightText text={service.process.description} highlight={service.process.descriptionHighlight || []} highlightClass="text-accent-green font-semibold" />
        </p>
      </div>

      <!-- Desktop Process Steps -->
      <div class="hidden lg:block relative">
        {/* Connection line for desktop */}
        <div class="absolute top-12 left-1/2 transform -translate-x-1/2 w-full max-w-4xl">
          <div class="h-0.5 bg-gradient-to-r from-accent-green/0 via-accent-green/40 to-accent-green/0"></div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 xl:gap-16">
          {service.process.steps.map((step, index) => (
            <div class="group opacity-0 fade-in-up-delay" style={`animation-delay: ${index * 0.15}s`}>
              <div class="relative bg-theme-card border border-accent-green/10 rounded-2xl p-6 lg:p-8 transition-all duration-500 hover:border-accent-green/40 hover:shadow-xl hover:shadow-accent-green/10 hover:-translate-y-1">
                {/* Step number */}
                <div class="flex items-center gap-4 mb-6">
                  <div class="relative">
                    <div class="absolute -inset-2 bg-accent-green/20 rounded-xl blur-lg opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <div class="relative w-12 h-12 bg-accent-green/10 rounded-xl flex items-center justify-center border border-accent-green/20 group-hover:bg-accent-green/20 group-hover:border-accent-green/40 transition-all duration-500">
                      <span class="text-lg font-bold text-accent-green font-display">{step.step}</span>
                    </div>
                  </div>
                  <h3 class="text-xl lg:text-2xl font-bold text-theme-primary group-hover:text-accent-green transition-colors duration-500 font-display">
                    {step.title}
                  </h3>
                </div>

                {/* Description */}
                <p class="text-body-base text-theme-secondary leading-relaxed mb-6 font-body">
                  {step.description}
                </p>

                {/* Deliverables */}
                <div class="space-y-3">
                  <h4 class="text-sm font-semibold text-theme-primary font-body uppercase tracking-wide">Deliverables</h4>
                  <ul class="space-y-2">
                    {step.deliverables.map((deliverable) => (
                      <li class="flex items-center gap-3 text-sm text-theme-secondary font-body">
                        <div class="w-4 h-4 bg-accent-green/15 rounded-full flex items-center justify-center flex-shrink-0">
                          <Icon name="mdi:check-circle" class="w-2.5 h-2.5 text-accent-green" />
                        </div>
                        {deliverable}
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Mobile Process Carousel -->
      <div class="lg:hidden">
        <Carousel
          containerId="service-process-carousel-container"
          trackId="service-process-carousel-track"
          dotSelector=".service-process-carousel-dot"
          items={service.process.steps}
          wrapperClass="service-process-carousel-wrapper"
          dotsClass="service-process-carousel-dots"
          dotClass="service-process-carousel-dot"
          breakpoint={1024}
          activateOnDesktop={false}
        >
          {service.process.steps.map((step, index) => (
            <div class="carousel-slide embla__slide flex-shrink-0" data-index={index}>
              <div class="h-full bg-theme-card border border-accent-green/10 rounded-2xl p-6 transition-all duration-500 hover:border-accent-green/40 hover:shadow-xl hover:shadow-accent-green/10 flex flex-col">
                {/* Step number */}
                <div class="flex items-center gap-4 mb-6">
                  <div class="w-12 h-12 bg-accent-green/10 rounded-xl flex items-center justify-center border border-accent-green/20">
                    <span class="text-lg font-bold text-accent-green font-display">{step.step}</span>
                  </div>
                  <h3 class="text-xl font-bold text-theme-primary font-display flex-1">
                    {step.title}
                  </h3>
                </div>

                {/* Description */}
                <p class="text-body-base text-theme-secondary leading-relaxed mb-6 font-body flex-grow">
                  {step.description}
                </p>

                {/* Deliverables */}
                <div class="space-y-3 mt-auto">
                  <h4 class="text-sm font-semibold text-theme-primary font-body uppercase tracking-wide">Deliverables</h4>
                  <ul class="space-y-2">
                    {step.deliverables.map((deliverable) => (
                      <li class="flex items-center gap-3 text-sm text-theme-secondary font-body">
                        <div class="w-4 h-4 bg-accent-green/15 rounded-full flex items-center justify-center flex-shrink-0">
                          <Icon name="mdi:check-circle" class="w-2.5 h-2.5 text-accent-green" />
                        </div>
                        {deliverable}
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          ))}
        </Carousel>
      </div>
    </div>
  </div>
</SectionContainer>
