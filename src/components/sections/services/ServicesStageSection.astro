---
import { Icon } from "astro-icon/components";
import SectionContainer from '@/components/layouts/SectionContainer.astro';
import HighlightCard from '@/components/ui/HighlightCard.astro';
import ServiceCard from '@/components/ui/ServiceCard.astro';
import HighlightText from '@/components/ui/HighlightText.astro';
import BackgroundDecorations from '@/components/ui/BackgroundDecorations.astro';
import SectionHeader from '@/components/ui/SectionHeader.astro';
import Carousel from '@/components/ui/Carousel.astro';
import { createUrl } from '@/utils/url";

interface Props {
  content: {
    title: string;
    description: string;
    descriptionHighlight?: string | string[];
    services: {
      name: string;
      description: string;
      descriptionHighlight?: string | string[];
      link: string;
    }[];
    codeEdge: string;
    codeEdgeHighlight?: string | string[];
  };
}

const { content } = Astro.props;

const serviceIcons = [
  "mdi:layers",
  "mdi:chart-box",
  "mdi:chart-line",
  "mdi:crystal-ball",
  "mdi:book-open-variant",
  "mdi:robot",
  "mdi:brain",
  "mdi:shield-check",
];
---

<SectionContainer
  id="services-stages"
  padding="normal"
  background="default"
  class="relative services-stages-section"
>
  <div
    class="absolute inset-0 pointer-events-none z-0"
    data-aos="fade-in"
    data-aos-duration="500"
    data-aos-easing="ease-out-cubic"
  >
    <BackgroundDecorations gradients={["hero"]} />
  </div>

  <div class="grid-container relative z-10 overflow-hidden">
    <div class="col-span-full max-w-7xl mx-auto w-full overflow-hidden">
      <div
        class="text-center mb-10 sm:mb-12 lg:mb-16 xl:mb-20"
        data-aos="fade-down"
        data-aos-duration="600"
        data-aos-easing="ease-out-cubic"
      >
        <h2 class="text-h2 font-extrabold mb-4 sm:mb-5 lg:mb-6 leading-tight tracking-tight font-display">
          Services for <span class="text-accent-green font-black text-[1.05em]">Every Stage</span>
        </h2>
        <p class="text-body-lg sm:text-body-xl text-theme-secondary leading-relaxed max-w-3xl mx-auto font-body">
          <HighlightText text={content.description} highlight="Eight" highlightClass="text-accent-green font-bold" />
        </p>
      </div>

      <div class="hidden lg:grid lg:grid-cols-4 gap-6 sm:gap-8 lg:gap-10 xl:gap-12 mb-10 sm:mb-12 lg:mb-16 overflow-hidden">
        {content.services.map((service, index) => (
          <div
            class="overflow-hidden"
            data-aos="fade-up"
            data-aos-duration="500"
            data-aos-delay={150 + (index * 75)}
            data-aos-easing="ease-out-cubic"
          >
            <ServiceCard
              icon={serviceIcons[index]}
              title={service.name}
              description={service.description}
              link={createUrl(service.link)}
              index={index}
              variant="grid"
            />
          </div>
        ))}
      </div>

      <Carousel
        containerId="services-carousel-container"
        trackId="services-carousel-track"
        dotSelector=".services-carousel-dot"
        items={content.services}
        wrapperClass="services-carousel services-carousel-wrapper"
        dotsClass="services-carousel-dots"
        dotClass="services-carousel-dot"
        breakpoint={1024}
        activateOnDesktop={false}
      >
        {content.services.map((service, index) => (
          <div 
            class="carousel-slide embla__slide flex-shrink-0" 
            data-index={index}
            data-aos="fade-up"
            data-aos-duration="500"
            data-aos-delay={200 + (index * 75)}
            data-aos-easing="ease-out-cubic"
          >
            <ServiceCard
              icon={serviceIcons[index]}
              title={service.name}
              description={service.description}
              link={createUrl(service.link)}
              index={index}
              variant="carousel"
            />
          </div>
        ))}
      </Carousel>

      <div
        class="mt-10 sm:mt-12 lg:mt-16"
        data-aos="fade-up"
        data-aos-duration="500"
        data-aos-delay="400"
        data-aos-easing="ease-out-cubic"
      >
        <div class="bg-gradient-to-br from-accent-green/15 via-accent-green/8 to-transparent border-2 border-accent-green/30 p-8 sm:p-10 lg:p-12 relative overflow-hidden group hover:border-accent-green/50 transition-all duration-500">
          <div class="absolute inset-0 opacity-[0.03] code-edge-pattern"></div>

          <div class="relative z-10">
            <p class="text-body-xl sm:text-[1.1875rem] lg:text-[1.375rem] xl:text-[1.5rem] text-theme-primary leading-relaxed font-body text-center">
              <HighlightText text={content.codeEdge} highlight={["consistent quality", "common language"]} highlightClass="text-accent-green font-bold" />
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</SectionContainer>

<style>
  .services-stages-section {
    overflow: hidden;
  }

  .services-stages-section [data-aos] {
    will-change: transform, opacity;
  }

  .services-carousel-wrapper,
  .services-carousel-wrapper .carousel-viewport,
  .services-carousel-wrapper .carousel-container {
    overflow: hidden;
  }

  .services-carousel-wrapper .carousel-track,
  .services-carousel-wrapper .embla__container {
    overflow: visible !important;
  }

  @media (min-width: 1024px) {
    .services-carousel-wrapper .carousel-slide,
    .services-carousel-wrapper .embla__slide {
      width: calc((100% - 4.5rem) / 4);
      flex: 0 0 calc((100% - 4.5rem) / 4);
    }

    .services-carousel-wrapper .carousel-track {
      gap: 1.5rem;
      justify-content: center;
    }

    .services-carousel-wrapper .service-card-redesigned[data-variant="carousel"]:hover,
    .service-card-redesigned[data-variant="grid"]:hover {
      transform: translateY(-4px);
      z-index: 10;
    }
  }

  @media (min-width: 1280px) {
    .services-carousel-wrapper .carousel-slide,
    .services-carousel-wrapper .embla__slide {
      width: calc((100% - 6rem) / 4);
      flex: 0 0 calc((100% - 6rem) / 4);
    }

    .services-carousel-wrapper .carousel-track {
      gap: 2rem;
    }
  }
</style>

<script>
  import { setupCarouselSection } from '@/scripts/sections/utils/carouselUtils";
  setupCarouselSection({
    containerId: "services-carousel-container",
    dotSelector: ".services-carousel-dot",
    breakpoint: 1024,
  });
</script>

