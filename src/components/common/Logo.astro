---
import { getBaseUrl } from "@/utils/url";

interface Props {
    size?: "sm" | "md" | "lg";
    showText?: boolean;
    href?: string;
    class?: string;
}

const {
    size = "md",
    showText = true,
    href,
    class: className = "",
} = Astro.props;

const defaultHref = getBaseUrl();

const sizeClasses = {
    sm: "h-9 w-9 sm:h-10 sm:w-10",
    md: "h-10 w-10 sm:h-11 sm:w-11 lg:h-12 lg:w-12",
    lg: "h-14 w-14 lg:h-16 lg:w-16",
};

const logoSize = sizeClasses[size];
---

<a
    href={href || defaultHref}
    class={`flex items-center space-x-2.5 sm:space-x-3 group relative touch-manipulation flex-shrink-0 z-content pointer-events-auto ${className}`}
    aria-label="AUXO Data Labs Home"
    data-nav-home
>
    <div class="relative">
        <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 40 40"
            fill="none"
            class={`${logoSize} transition-transform duration-normal group-hover:scale-110 group-hover:rotate-3`}
            aria-label="AUXO Data Labs Logo"
        >
            <rect
                x="0"
                y="0"
                width="18"
                height="18"
                fill="var(--accent-green)"
                class="transition-colors duration-normal"></rect>
            <text
                x="9"
                y="14"
                text-anchor="middle"
                font-family="var(--font-brand)"
                font-weight="900"
                font-size="13"
                fill="var(--logo-text-color)"
                class="transition-colors duration-normal">A</text
            >
            <rect
                x="22"
                y="0"
                width="18"
                height="18"
                fill="var(--accent-green)"
                class="transition-colors duration-normal"></rect>
            <text
                x="31"
                y="14"
                text-anchor="middle"
                font-family="var(--font-brand)"
                font-weight="900"
                font-size="13"
                fill="var(--logo-text-color)"
                class="transition-colors duration-normal">U</text
            >
            <rect
                x="0"
                y="22"
                width="18"
                height="18"
                fill="var(--accent-green)"
                class="transition-colors duration-normal"></rect>
            <text
                x="9"
                y="36"
                text-anchor="middle"
                font-family="var(--font-brand)"
                font-weight="900"
                font-size="13"
                fill="var(--logo-text-color)"
                class="transition-colors duration-normal">X</text
            >
            <rect
                x="22"
                y="22"
                width="18"
                height="18"
                fill="var(--accent-green)"
                class="transition-colors duration-normal"></rect>
            <text
                x="31"
                y="36"
                text-anchor="middle"
                font-family="var(--font-brand)"
                font-weight="900"
                font-size="13"
                fill="var(--logo-text-color)"
                class="transition-colors duration-normal">O</text
            >
        </svg>
        <div
            class="absolute inset-0 bg-accent-green/20 rounded-full blur-lg opacity-0 group-hover:opacity-100 transition-opacity duration-normal"
        >
        </div>
    </div>
    {
        showText && (
            <div class="flex flex-col hidden lg:flex items-center pointer-events-none">
                <div class="logo-text-container">
                    <span class="logo-tagline">
                        Data Labs
                    </span>
                    <span class="logo-subtitle">
                        Look Beyond Data
                    </span>
                </div>
            </div>
        )
    }

<script>
    function matchLogoWidths() {
        if (typeof document === 'undefined') return;
        
        const tagline = document.querySelector('.logo-tagline') as HTMLElement;
        const subtitle = document.querySelector('.logo-subtitle') as HTMLElement;
        
        if (!tagline || !subtitle) return;
        
        const updateWidth = () => {
            // Batch DOM reads to avoid forced reflows
            const taglineWidth = tagline.offsetWidth;
            const subtitleWidth = subtitle.scrollWidth;
            const computedStyle = getComputedStyle(subtitle);
            const currentLetterSpacing = parseFloat(computedStyle.letterSpacing) || 0;
            const fontSize = parseFloat(computedStyle.fontSize) || 12;
            const textLength = subtitle.textContent?.length || 0;

            if (taglineWidth > 0 && subtitleWidth > 0 && textLength > 0 && subtitleWidth < taglineWidth) {
                const widthDiff = taglineWidth - subtitleWidth;
                const letterSpacingPerChar = widthDiff / Math.max(1, textLength - 1);
                const newLetterSpacing = currentLetterSpacing + letterSpacingPerChar;

                // Use requestAnimationFrame for DOM write
                requestAnimationFrame(() => {
                    subtitle.style.letterSpacing = `${newLetterSpacing}px`;
                });
            }
        };
        
        const init = () => {
            setTimeout(updateWidth, 0);
            setTimeout(updateWidth, 100);
            setTimeout(updateWidth, 300);
        };
        
        init();
        window.addEventListener('resize', updateWidth);
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        }
    }
    
    matchLogoWidths();
</script>
</a>
