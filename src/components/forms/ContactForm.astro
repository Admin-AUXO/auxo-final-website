---
import { Icon } from "astro-icon/components";
import { createUrl } from "@/utils/url";

export interface Props {
  class?: string;
}

const { class: className = "" } = Astro.props;

const inputBaseClass = "w-full px-4 py-3 bg-theme-surface border-2 border-accent-green/20 rounded-xl text-theme-primary placeholder-theme-tertiary focus:outline-none focus:border-accent-green focus:ring-2 focus:ring-accent-green/20 transition-all duration-fast font-body min-h-[var(--input-min-height)] hover:border-accent-green/30";
const labelBaseClass = "block text-sm font-bold text-theme-primary mb-2 font-body";
---

<div class={`bg-theme-card border-2 border-accent-green/20 rounded-2xl p-6 sm:p-8 relative overflow-hidden group hover:border-accent-green/30 transition-all duration-normal h-full ${className}`}>
  <div class="absolute top-0 right-0 bg-accent-green/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 opacity-50 group-hover:opacity-75 transition-opacity duration-normal pointer-events-none" style="width: var(--decorative-size-md); height: var(--decorative-size-md);"></div>
  <div class="absolute bottom-0 left-0 bg-accent-green/5 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 opacity-30 group-hover:opacity-60 transition-opacity duration-normal pointer-events-none" style="width: var(--decorative-size-sm); height: var(--decorative-size-sm);"></div>

  <form id="contact-form-element" class="relative z-10 space-y-5">
    <div class="grid sm:grid-cols-2 gap-4">
      <div>
        <label for="name" class={labelBaseClass}>
          Name <span class="text-accent-green">*</span>
        </label>
        <input type="text" id="name" name="name" required class={inputBaseClass} placeholder="Your name" />
      </div>
      <div>
        <label for="email" class={labelBaseClass}>
          Email <span class="text-accent-green">*</span>
        </label>
        <input type="email" id="email" name="email" required class={inputBaseClass} placeholder="you@company.com" />
      </div>
    </div>

    <div>
      <label for="company" class={labelBaseClass}>
        Company <span class="text-theme-tertiary text-xs font-normal">(Optional)</span>
      </label>
      <input type="text" id="company" name="company" class={inputBaseClass} placeholder="Your company" />
    </div>

    <div>
      <label for="subject" class={labelBaseClass}>
        Subject <span class="text-accent-green">*</span>
      </label>
      <input type="text" id="subject" name="subject" required class={inputBaseClass} placeholder="What brings you here?" />
    </div>

    <div>
      <div class="flex items-center justify-between mb-2">
        <label for="message" class={labelBaseClass + " mb-0"}>
          Message <span class="text-accent-green">*</span>
        </label>
        <span id="message-counter" class="text-xs text-theme-tertiary font-mono font-body" aria-live="polite">
          0/500
        </span>
      </div>
      <textarea
        id="message"
        name="message"
        required
        rows="4"
        maxlength="500"
        class={`${inputBaseClass} resize-y min-h-[var(--textarea-min-height)]`}
        placeholder="Tell us about your project or challenge..."
      ></textarea>
    </div>

    <button
      type="submit"
      class="w-full px-6 py-4 bg-accent-green text-on-accent font-bold rounded-xl hover:bg-accent-green/90 hover:shadow-xl hover:shadow-accent-green/30 hover:-translate-y-0.5 active:bg-accent-green/80 active:translate-y-0 transition-all duration-fast focus:outline-none focus:ring-2 focus:ring-accent-green focus:ring-offset-2 focus:ring-offset-theme-card min-h-[var(--button-height-lg)] font-body flex items-center justify-center gap-2 group/btn"
    >
      <span>Send Message</span>
      <Icon name="mdi:send" class="w-5 h-5 group-hover/btn:translate-x-1 group-hover/btn:-translate-y-0.5 transition-transform duration-fast" />
    </button>

    <p class="text-xs text-theme-secondary text-center font-body pt-1">
      By submitting, you agree to our{" "}
      <a href={createUrl("legal/privacy-policy")} class="text-accent-green hover:underline font-medium transition-colors">
        Privacy Policy
      </a>
    </p>
  </form>
</div>

<script>
  import { initEmailJS, handleContactFormSubmit, addRealTimeValidation } from '@/scripts/forms/emailHandler';

  function initContactForm() {
    const form = document.getElementById('contact-form-element') as HTMLFormElement;
    if (!form) return;

    initEmailJS();
    form.addEventListener('submit', handleContactFormSubmit);
    addRealTimeValidation(form);
  }

  if (typeof window !== 'undefined') {
    document.addEventListener('astro:page-load', initContactForm);
  }
</script>
