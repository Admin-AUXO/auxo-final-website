---
export interface Props {
  text: string;
  highlight?: string | string[];
  highlightClass?: string;
}

const { text, highlight, highlightClass = "text-accent-green" } = Astro.props;

const highlights = !highlight ? [] : Array.isArray(highlight) ? highlight : [highlight];

function splitText(text: string, highlights: string[]): Array<{ text: string; isHighlight: boolean }> {
  if (highlights.length === 0) return [{ text, isHighlight: false }];
  
  let parts: Array<{ text: string; isHighlight: boolean }> = [{ text, isHighlight: false }];
  
  for (const highlightText of highlights) {
    const newParts: Array<{ text: string; isHighlight: boolean }> = [];
    
    for (const part of parts) {
      if (part.isHighlight) {
        newParts.push(part);
        continue;
      }
      
      const lowerText = part.text.toLowerCase();
      const lowerHighlight = highlightText.toLowerCase();
      const index = lowerText.indexOf(lowerHighlight);
      
      if (index === -1) {
        newParts.push(part);
      } else {
        if (index > 0) {
          newParts.push({ text: part.text.substring(0, index), isHighlight: false });
        }
        newParts.push({ text: part.text.substring(index, index + highlightText.length), isHighlight: true });
        if (index + highlightText.length < part.text.length) {
          newParts.push({ text: part.text.substring(index + highlightText.length), isHighlight: false });
        }
      }
    }
    
    parts = newParts;
  }
  
  return parts;
}

const parts = splitText(text, highlights);
---

{parts.map((part) => (
  part.isHighlight ? (
    <span class={highlightClass}>{part.text}</span>
  ) : (
    part.text
  )
))

