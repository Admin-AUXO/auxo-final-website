---
// Utility component for highlighting specific text within a string
export interface Props {
  text: string;
  highlight: string | string[];
  highlightClass?: string;
}

const { text, highlight, highlightClass = "text-accent-green" } = Astro.props;

// Convert single highlight to array
const highlights = Array.isArray(highlight) ? highlight : [highlight];

// Split text by highlights - simple approach
function splitText(text: string, highlights: string[]): Array<{ text: string; isHighlight: boolean }> {
  if (highlights.length === 0) return [{ text, isHighlight: false }];
  
  let remaining = text;
  const parts: Array<{ text: string; isHighlight: boolean }> = [];
  
  // Process each highlight term
  highlights.forEach((highlightText) => {
    const newParts: Array<{ text: string; isHighlight: boolean }> = [];
    
    for (const part of parts.length > 0 ? parts : [{ text: remaining, isHighlight: false }]) {
      if (part.isHighlight) {
        newParts.push(part);
        continue;
      }
      
      const lowerText = part.text.toLowerCase();
      const lowerHighlight = highlightText.toLowerCase();
      const index = lowerText.indexOf(lowerHighlight);
      
      if (index === -1) {
        newParts.push(part);
      } else {
        // Add text before highlight
        if (index > 0) {
          newParts.push({ text: part.text.substring(0, index), isHighlight: false });
        }
        // Add highlighted text
        newParts.push({ text: part.text.substring(index, index + highlightText.length), isHighlight: true });
        // Add text after highlight
        if (index + highlightText.length < part.text.length) {
          newParts.push({ text: part.text.substring(index + highlightText.length), isHighlight: false });
        }
      }
    }
    
    parts.length = 0;
    parts.push(...newParts);
  });
  
  return parts.length > 0 ? parts : [{ text, isHighlight: false }];
}

const parts = splitText(text, highlights);
---

{parts.map((part) => (
  part.isHighlight ? (
    <span class={highlightClass}>{part.text}</span>
  ) : (
    part.text
  )
))

