---
import { Icon } from "astro-icon/components";

interface Props {
  isMobileSwitch?: boolean;
}

const { isMobileSwitch = false } = Astro.props;
---

<button
  id="theme-toggle"
  type="button"
  class:list={[
    "theme-toggle relative transition-all duration-fast flex items-center justify-center active:scale-95",
    isMobileSwitch
      ? "theme-toggle-switch w-12 h-6 rounded-full bg-surface border border-theme flex-shrink-0"
      : "w-10 h-10 rounded-lg bg-surface border border-theme text-secondary hover:text-accent-green hover:bg-accent-green/10 hover:border-accent-green/30 touch-target",
  ]}
  aria-label="Toggle theme"
  title="Toggle dark/light mode"
  data-mobile-switch={isMobileSwitch}
>
  {
    isMobileSwitch ? (
      <div class="theme-switch-track relative w-full h-full rounded-full bg-surface overflow-hidden">
        <div class="theme-switch-bg absolute inset-0 transition-colors duration-normal" />
        <div class="theme-switch-knob absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-primary border border-theme shadow-md transition-transform duration-normal flex items-center justify-center">
          <Icon
            name="mdi:moon-waning-crescent"
            class="theme-icon-dark absolute w-3 h-3 transition-all duration-normal opacity-100 text-theme-secondary"
          />
          <Icon
            name="mdi:white-balance-sunny"
            class="theme-icon-light absolute w-3 h-3 transition-all duration-normal opacity-0 text-theme-secondary"
          />
        </div>
      </div>
    ) : (
      <div class="relative w-full h-full flex items-center justify-center">
        <Icon
          name="mdi:moon-waning-crescent"
          class="theme-icon-dark absolute w-6 h-6 sm:w-7 sm:h-7 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transition-all duration-normal opacity-100 rotate-0 scale-100 text-theme-secondary"
        />
        <Icon
          name="mdi:white-balance-sunny"
          class="theme-icon-light absolute w-6 h-6 sm:w-7 sm:h-7 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transition-all duration-normal opacity-0 rotate-90 scale-0 text-theme-secondary"
        />
      </div>
    )
  }
</button>

<script>
  import { initThemeToggle } from "../../scripts/ui/themeToggle";
  initThemeToggle();
</script>

<style>
  .theme-toggle {
    position: relative;
    overflow: hidden;
    color: var(--text-secondary) !important;
  }

  .theme-toggle:hover {
    color: var(--accent-green) !important;
  }

  .theme-icon-dark,
  .theme-icon-light {
    transition:
      opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--text-secondary) !important;
  }

  .theme-toggle:hover .theme-icon-dark,
  .theme-toggle:hover .theme-icon-light {
    color: var(--accent-green) !important;
  }

  .theme-toggle-switch {
    padding: 0;
  }

  .theme-switch-track {
    position: relative;
  }

  .theme-switch-bg {
    background-color: var(--bg-surface);
    transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .theme-switch-knob {
    transform: translateX(0);
    z-index: 1;
    transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  :root.dark .theme-switch-knob,
  :root:not(.light) .theme-switch-knob {
    transform: translateX(0);
  }

  :root.light .theme-switch-knob {
    transform: translateX(calc(3rem - 1.25rem - 0.125rem));
  }

  .theme-toggle-switch:hover {
    border-color: var(--accent-green);
  }

  .theme-toggle-switch {
    flex-shrink: 0;
  }
</style>

