---
export interface Props {
  variant?: 'primary' | 'secondary' | 'tertiary' | 'ghost' | 'outline' | 'cta';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  href?: string;
  target?: string;
  rel?: string;
  type?: 'button' | 'submit' | 'reset';
  class?: string;
  ariaLabel?: string;
  id?: string;
  googleCalendar?: boolean;
  showArrow?: boolean;
}

const {
  variant = 'primary',
  size = 'md',
  disabled = false,
  href,
  target,
  rel,
  type = 'button',
  class: className = '',
  ariaLabel,
  id,
  googleCalendar = false,
  showArrow = false,
} = Astro.props;

const isGoogleCalendar = googleCalendar === true;

const sizeClasses = {
  sm: 'px-4 py-2.5 text-sm min-h-[var(--touch-target-min)]',
  md: 'px-5 sm:px-6 py-3 text-base sm:text-lg min-h-[var(--button-height-md)] sm:min-h-[var(--touch-target-min)]',
  lg: 'px-6 sm:px-8 py-3.5 sm:py-4 text-base sm:text-lg md:text-xl min-h-[var(--button-height-lg)] sm:min-h-[var(--touch-target-md)]',
};

const variantClasses = {
  primary: 'btn-primary',
  secondary: 'btn-secondary',
  tertiary: 'btn-ghost',
  ghost: 'btn-ghost',
  outline: 'btn-outline',
  cta: 'nav-cta border-2 border-accent-green bg-transparent text-accent-green hover:bg-accent-green/10 hover:shadow-lg hover:shadow-accent-green/30 hover:-translate-y-0.5 active:bg-accent-green/20 active:translate-y-0 relative group/cta',
};

const baseClasses = `
  inline-flex items-center justify-center gap-2
  font-semibold rounded-lg
  transition-all duration-fast
  focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-green focus-visible:ring-offset-2
  disabled:opacity-50 disabled:cursor-not-allowed disabled:pointer-events-none
  touch-manipulation
  whitespace-nowrap
  flex-nowrap
  ${sizeClasses[size]}
  ${variantClasses[variant]}
  ${className}
`.trim().replace(/\s+/g, ' ');

const Tag = (href && !isGoogleCalendar) ? 'a' : 'button';
const tagProps = (href && !isGoogleCalendar)
  ? {
      href: disabled ? undefined : href,
      target,
      rel: target === '_blank' ? 'noopener noreferrer' : rel,
    }
  : {
      type,
      disabled,
      ...(isGoogleCalendar ? { 
        'data-google-calendar-open': '',
        'href': undefined,
        'target': undefined,
        'onclick': 'return false;'
      } : {}),
    };
---

<Tag
  class={baseClasses}
  id={id}
  aria-label={ariaLabel}
  aria-disabled={disabled ? 'true' : undefined}
  {...tagProps}
>
  {variant === 'cta' ? (
    <>
      <span class="relative z-10">
        <slot />
      </span>
      {showArrow && (
        <svg
          width="1em"
          height="1em"
          viewBox="0 0 24 24"
          class="w-4 h-4 flex-shrink-0 group-hover/cta:translate-x-1 transition-transform duration-300 relative z-10"
          aria-hidden="true"
        >
          <use href="#ai:mdi:arrow-right"></use>
        </svg>
      )}
      <span class="absolute inset-0 bg-accent-green/5 rounded-xl opacity-0 group-hover/cta:opacity-100 transition-opacity duration-fast"></span>
    </>
  ) : (
    <slot />
  )}
</Tag>


